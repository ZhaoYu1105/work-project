

## API 描述

前端单网页应用通过 Ajax 完成：

1. 登录（选择登录方式）、绑定手机号、找回密码等
1. 显示授权画面（目前仅有登录功能，且是自动授权，故此页面目前不显示）
1. 授权并根据相应的授权模式调用后台API，完成授权后，跳转回相应的 redirect_uri 


采用在 前端单网页中完成该流程的原因是：

* 从微信等认证服务器都是跳转到到后台，
* 但如果要显示部分画面（比如提交用户名密码、注册、找回密码、绑定手机号 等），还需要跳转回前台页面
* 来回跳转还要保持携带各种参数
* 登录过程中可能要绕大圈（注册、绑定手机号、找回密码等），跳转流程复杂。




## 参数

### 共通参数



### OAuth2 的 Authorize Code 模式

在 URL Hash 中接收的参数列表

* `response_type`   : 固定值为 "code"
* `client_id`       :
* `redirect_uri`    : 认证后返回的URL
* `scope`           : 要授权的 scope 列表
* `state`           :


### OAuth2 的 Implicit 模式:

在 URL Hash 中接收的参数列表

 * `response_type`   : 固定值为 "token"
 * `client_id`       :
 * `redirect_uri`    : 认证后返回的URL
 * `scope`           : 要授权的 scope 列表
 * `state`           :

## 业务处理流程

- 调用 API 检查用户当前是否已经登录

    - 如果没有登录，则检测环境，使用最优登录方式，倒计时登录登录，但是当前 URI 要通过某种机制保留，比如 localStorage .
    - 比如：如果是在微信内打开，则先提示将去微信登录，3秒倒计时。如果用户不想使用微信登录，在此3秒内可以点击其他 "登录方式" 按钮。
    - 用户从微信授权返回后，不再直接返回到后台API，即直接返回到前端单网页应用 比如 "#/cb/wx?code=xxx&state=xxx"
    - 取得 微信返回的 code，state参数，调用后台API，完成code 换取微信 access token。但是此时需要根据API结果判断
    
        - 用户是否已经登录（即——曾绑定手机号）
        - 用户尚未登录（即——尚未绑定手机号，仅仅是完成了微信的授权验证）。
          此时需要跳转到绑定手机号页面，并调用API，完成绑定。
          绑定后，已完成用户登录。 
    - 完成登录后，页面重新切换为最初授权的完整URI（主要是指hash，以及hash上的参数）

- 调用授权API，获取处理后的 redirect_uri 
- 将浏览器重定向到 处理后的 redirect_uri


